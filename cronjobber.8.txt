
cronjobber(8)             BSD System Manager’s Manual            cronjobber(8)

NNAAMMEE
     ccrroonnjjoobbbbeerr — cron job wrapper

SSYYNNOOPPSSIISS
     ccrroonnjjoobbbbeerr −−nn _j_o_b_n_a_m_e −−ss _s_t_a_t_e_d_i_r −−cc _j_o_b [−−DD _j_o_b_d_i_r] [−−rr _m_a_x_b_a_c_k_o_f_f]
                [−−xx _c_h_e_c_k_e_r] [−−ee _v_a_r_=_v_a_l] [−−mm _u_m_a_s_k] [−−tt _t_i_m_e_o_u_t] [−−kk _s_i_g_n_o]
                [−−55 _c_r_a_s_h_‐_s_u_b_j_e_c_t] [−−SS _f_a_i_l_‐_s_u_b_j_e_c_t] [−−FF _f_r_o_m] [−−TT _t_o]
                [−−MM _s_e_n_d_m_a_i_l] [−−aa _a_g_e] [−−ll] [−−hh] [−−VV]

DDEESSCCRRIIPPTTIIOONN
     ccrroonnjjoobbbbeerr is a wrapper providing cron jobs with the ability to log each
     run, to timeout long running or hung jobs, to randomize startup times,
     and to selectively mail job output.  In normal usage, a crontab(5) entry
     invokes ccrroonnjjoobbbbeerr, which then invokes your job.  The following options
     are recognized:

     −−nn _j_o_b_n_a_m_e
             Short name for this job.  Used in mail subject lines and error
             messages to identify this job.

     −−ss _s_t_a_t_e_d_i_r
             Name of directory used to hold job state and logs.  This direc‐
             tory must exist and must be writable by the crontab owner.  It
             must also support fcntl(2) locking.

     −−cc _j_o_b  Path to actual job to run, and any arguments.  ccrroonnjjoobbbbeerr passes
             this string unmodified to a shell to execute.  Path is relative
             to _j_o_b_d_i_r.  If no _j_o_b_d_i_r is specified, path will be relative to
             HOME.  It is probably best to specify the full path to the job.

     −−DD _j_o_b_d_i_r
             Change to _j_o_b_d_i_r before invoking the job.  If −−DD is not given,
             then the value of HOME is used.  If HOME is not set, then the
             password entry for the effective user id is used.

     −−rr _m_a_x_b_a_c_k_o_f_f
             Maximum random backoff time.  If not specified, the job will be
             executed immediately.  Otherwise, ccrroonnjjoobbbbeerr will wait for a ran‐
             dom time between 0 and _m_a_x_b_a_c_k_o_f_f seconds to execute the job.

     −−xx _c_h_e_c_k_e_r
             Path to checker script relative to _s_t_a_t_e_d_i_r.  See below for the
             checker API.

     −−ee _v_a_r_[_=_v_a_l_]
             Modify environment passed to _j_o_b and to _c_h_e_c_k_e_r.  A minimal envi‐
             ronment is constructed and passed to the job and to the checker.
             This includes HOME, LOGNAME, PATH, SHELL, and USER.  Additional
             variables may be included by using the −−ee flag.  If the argument
             to −−ee is just a variable name without an equals, then the value
             of that variable at ccrroonnjjoobbbbeerr run time will be included in the
             made‐up environment.  If the argument has an equals, but no
             value, then the variable will be set, but empty in the made‐up
             environment.  Otherwise if a value is provided, that will be the
             value set in the made‐up environment.

             Multiple environment variables can be set by using multiple −−ee
             flags.

     −−mm _u_m_a_s_k
             Set umask before invoking job.  Use the normal octal representa‐
             tion.

     −−tt _t_i_m_e_o_u_t
             Attempt to kill job after _t_i_m_e_o_u_t seconds.  If no timeout is
             given, the job may run indefinitely.  The default signal is
             SIGTERM, but this may be changed with the −−kk flag.  It is best to
             test that timeouts actually work on your system.  You may have to
             change the signal number because different shells may ignore cer‐
             tain signals.

     −−kk _s_i_g_n_o
             If the −−rr flag was given to enable a job timeout signal, then
             send signal _s_i_g_n_o rather than the default SIGTERM.  _s_i_g_n_o must be
             numeric.

     −−55 _c_r_a_s_h_‐_s_u_b_j_e_c_t
             If ccrroonnjjoobbbbeerr discovers the previous instance of itself has
             crashed (the log is still present), it will send a message with a
             subject "crashed" and the _j_o_b_n_a_m_e.  You can change this subject
             with the −−55 flag.

     −−SS _f_a_i_l_‐_s_u_b_j_e_c_t
             If the checker decides the job has failed, ccrroonnjjoobbbbeerr will send a
             message with a subject "failed", and the _j_o_b_n_a_m_e.  You can change
             this subject with the −−SS flag.

     −−FF _F_r_o_m
             Set the envelope sender and From: header to _F_r_o_m.

     −−TT _T_o   Send crash and error messages to _T_o.  To send to multiple recipi‐
             ents, use multiple −−TT flags.

     −−MM _s_e_n_d_m_a_i_l
             Specify exact path to sendmail.  ccrroonnjjoobbbbeerr will check MAILER or
             the PATH provided by cron(8) for sendmail.  This path may not
             include sendmail, so it is best to spell it out with −−MM.

     −−aa _a_g_e  ccrroonnjjoobbbbeerr removes log files older than _a_g_e seconds.  _a_g_e may be
             suffixed by s, m, h or d to indicate seconds, minutes, hours or
             days, respectively.  For example, use 7d to specify a week.

     −−ll      List command line arguments.  Parse command line, print the
             results and exit.

     −−hh      Print usage and exit.

     −−VV      Print version and exit.

CCHHEECCKKEERR AAPPII
     The job of the checker script is to decide whether or not to email the
     output of the latest job run.  It does this by looking at the output log
     and exiting 0 or 1.  When the checker is invoked, its environment looks
     like this:

     Current directory
             The checker will be invoked from within the _s_t_a_t_e_d_i_r passed to
             cronjobber with the −−ss flag.

     Environment
             The checker will inherit the same minimal environment passed to
             the job, plus one of the following variables: WEXITSTATUS,
             WTERMSIG or WSTATUS.  If the job exited normally, WEXITSTATUS
             will hold the job exit status.  Otherwise if the job was termi‐
             nated by a signal then WTERMSIG will hold the signal number.  If
             WSTATUS is set, there might be a bug in cronjobber on your plat‐
             form.

     Standard input
             The checker’s standard input will be the job’s log file.

     Standard out and standard error
             stdout and stderr are not redirected, so any output from the
             checker will result in cron sending mail to the crontab owner.

     Command line
             No command line arguments are passed to the checker in the cur‐
             rent version.

     The checker should exit 0 if the job was successful and no mail should be
     sent.  Otherwise exit 1 to have the job output emailed to the recipients
     passed with the −−TT flag(s).

EENNVVIIRROONNMMEENNTT
     HOME    Default _j_o_b_d_i_r.

     LOGNAME
             Used to determine default mail recipient.

     MAILER  Default location of sendmail.

     SHELL   The value of SHELL is used to when invoking the job.  If SHELL is
             not set, then _/_b_i_n_/_s_h is used.  The job is invoked as the −−cc
             argument to the shell.

     USER    Used to determine default mail recipient.  Takes precedence over
             LOGNAME.

FFIILLEESS
     Within the _s_t_a_t_e_d_i_r the following files are significant:

     lock    Lock file used to prevent multiple instances from running at
             once.

     log     Current log file, stdout and stderr of the job itself.  If this
             file exists, then there is an instance of the job running, or
             ccrroonnjjoobbbbeerr was killed before it could rotate the log file.  A
             killed log file will be sent in a "crashed" message the next time
             ccrroonnjjoobbbbeerr runs.

     log.timestamp
             When the job and the checker have finished, the log file is
             renamed with a timestamp.  The timestamp is in the form YYYYmmd‐
             dHHMMss.  Normally the timestamp is the job start time.  But if
             ccrroonnjjoobbbbeerr crashed and the log had to be cleaned up, the time‐
             stamp will be the mtime of the log file.

EEXXIITT SSTTAATTUUSS
     ccrroonnjjoobbbbeerr will exit 0 if it finished successfully, 1 otherwise.  Note
     that the exit value of the job and the checker do not influence the exit
     value of ccrroonnjjoobbbbeerr.  Also note that cron(8) doesn’t really care about
     the exit value of a job anyway.

SSEEEE AALLSSOO
     cron(8), crontab(1), crontab(5), environ(7), sendmail(8), signal(3),
     umask(2)

AAUUTTHHOORR
     Daniel Lawrence ⟨https://github.com/wavemechanics/cronjobber/⟩

BBUUGGSS
     Please report.

BSD                             January 3, 2020                            BSD
